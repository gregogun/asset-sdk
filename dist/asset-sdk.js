var e=require("zod"),n=require("arweave"),t=require("@bundlr-network/client"),r=require("ramda");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=/*#__PURE__*/o(n),s=/*#__PURE__*/o(t),a=e.z.object({arweave:e.z.instanceof(i.default),bundlr:e.z.instanceof(s.default),contracts:e.z.object({stamp:e.z.string().default("FMRHYgSijiUNBrFy-XqyNNXenHsCV0ThR4lGAPO4chA"),bar:e.z.string().default("VFr3Bk-uM-motpNNkkFg4lNW1BMmSfzqsVO551Ho4hA")}).default({stamp:"FMRHYgSijiUNBrFy-XqyNNXenHsCV0ThR4lGAPO4chA",bar:"VFr3Bk-uM-motpNNkkFg4lNW1BMmSfzqsVO551Ho4hA"}),sources:e.z.object({asset:e.z.string().default("x0ojRwrcHBmZP20Y4SY0mgusMRx-IYTjg5W8c3UFoNs")}).default({asset:"x0ojRwrcHBmZP20Y4SY0mgusMRx-IYTjg5W8c3UFoNs"})});function u(){return u=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},u.apply(this,arguments)}function c(e,n,t){if(!e.s){if(t instanceof f){if(!t.s)return void(t.o=c.bind(null,e,n));1&n&&(n=t.s),t=t.v}if(t&&t.then)return void t.then(c.bind(null,e,n),c.bind(null,e,2));e.s=n,e.v=t;const r=e.o;r&&r(e)}}var f=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(n,t){var r=new e,o=this.s;if(o){var i=1&o?n:t;if(i){try{c(r,1,i(this.v))}catch(e){c(r,2,e)}return r}return this}return this.o=function(e){try{var o=e.v;1&e.s?c(r,1,n?n(o):o):t?c(r,1,t(o)):c(r,2,o)}catch(e){c(r,2,e)}},r},e}();function d(e){return e instanceof f&&1&e.s}var l=r.find(r.compose(r.propEq("value","source"),r.find(r.propEq("name","Type")),r.prop("tags"))),p=function(e){return r.find(r.compose(r.propEq("value",e),r.find(r.propEq("name","Type")),r.prop("tags")))};module.exports={init:function(e){var n=function(e){return{getData:function(n){return e.arweave.api.get(n).then(r.prop("data"))},gql:function(n){try{var t=!0,o=[],i="",s=function(e,n,t){for(var r;;){var o=e();if(d(o)&&(o=o.v),!o)return i;if(o.then){r=0;break}var i=t();if(i&&i.then){if(!d(i)){r=1;break}i=i.s}}var s=new f,a=c.bind(null,s,2);return(0===r?o.then(l):1===r?i.then(u):(void 0).then(function(){(o=e())?o.then?o.then(l).then(void 0,a):l(o):c(s,1,i)})).then(void 0,a),s;function u(n){i=n;do{if(!(o=e())||d(o)&&!o.v)return void c(s,1,i);if(o.then)return void o.then(l).then(void 0,a);d(i=t())&&(i=i.v)}while(!i||!i.then);i.then(u).then(void 0,a)}function l(e){e?(i=t())&&i.then?i.then(u).then(void 0,a):u(i):c(s,1,i)}}(function(){return!!t},0,function(){return Promise.resolve((s={query:n.query,variables:u({},n.variables,{cursor:i})},e.arweave.api.post("graphql",s).then(r.path(["data","data","transactions"])))).then(function(e){e.edges&&e.edges.length&&(o=o.concat(e.edges),i=e.edges[e.edges.length-1].cursor),t=e.pageInfo.hasNextPage});var s});return Promise.resolve(s&&s.then?s.then(function(){return o}):o)}catch(e){return Promise.reject(e)}}}}(e=a.parse(e));return{get:function(e,t){return function(e){return{getAsset:function(n,t){return function(e,n){return Promise.resolve({query:'query ($ids: [String!]!, $cursor: String, $type: String!) {\n      transactions(first: 3, after: $cursor, \n        tags: [\n          { name: "Type", values: [$type] },\n          { name: "Asset-Id", values: $ids }\n        ]) {\n        pageInfo {\n          hasNextPage\n        }\n        edges {\n          cursor\n          node {\n            id\n            tags {\n              name\n              value\n            }\n          }\n        }\n      }\n    }',variables:{ids:[e],type:n}})}(n,t).then(e.gql).then(function(e){return function(n){return{source:r.compose(l,r.pluck("node"))(n),asset:r.compose(p(e),r.pluck("node"))(n)}}}(t)).then(function(n){return Promise.all([n.source?e.getData(n.source.id):Promise.resolve("No Source Found."),n.asset?e.getData(n.asset.id):Promise.resolve("No Content Found")]).then(function(e){var t,o,i,s,a=e[0],c=e[1];return u({},(t=n.asset,i=(o=r.compose(r.prop("value"),function(e){return r.find(r.propEq("name",e),t.tags)}))("Published")?Number(o("Published")):Date.now(),s=r.join(", ",r.pluck("value",r.filter(function(e){return/^Topic:/.test(e.name)},t.tags))),{id:o("Asset-Id"),type:o("Type"),title:o("Title"),description:o("Description"),transaction:t.id,published:i,stamps:0,topics:s}),{content:a,html:c})})})}}}(n).getAsset(e,t)}}}};
//# sourceMappingURL=asset-sdk.js.map
